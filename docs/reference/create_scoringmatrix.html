<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a scoring matrix given matching and non-matching sets of neurons — create_scoringmatrix • nat.nblast</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create a scoring matrix given matching and non-matching sets of neurons — create_scoringmatrix" />
<meta property="og:description" content="Calculate a scoring matrix embodying the logarithm of the odds
  that a matching pair of neurite segments come from a structurally related
  rather than random pair of neurons. This function embodies sensible default
  behaviours and is recommended for end users. More control is available by
  using the individual functions listed in See Also." />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat.nblast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/NBLAST-Clustering.html">NBLAST Clustering</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../SUPPORT.html">Help</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://natverse.github.io">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/nat.nblast">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a scoring matrix given matching and non-matching sets of neurons</h1>
    <small class="dont-index">Source: <a href='https://github.com/natverse/nat.nblast/blob/master/R/smat.r'><code>R/smat.r</code></a></small>
    <div class="hidden name"><code>create_scoringmatrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate a scoring matrix embodying the logarithm of the odds
  that a matching pair of neurite segments come from a structurally related
  rather than random pair of neurons. This function embodies sensible default
  behaviours and is recommended for end users. More control is available by
  using the individual functions listed in <b>See Also</b>.</p>
    </div>

    <pre class="usage"><span class='fu'>create_scoringmatrix</span><span class='op'>(</span>
  <span class='va'>matching_neurons</span>,
  <span class='va'>nonmatching_neurons</span>,
  matching_subset <span class='op'>=</span> <span class='cn'>NULL</span>,
  non_matching_subset <span class='op'>=</span> <span class='cn'>NULL</span>,
  ignoreSelf <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>distbreaks</span>,
  dotprodbreaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, by <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>,
  logbase <span class='op'>=</span> <span class='fl'>2</span>,
  epsilon <span class='op'>=</span> <span class='fl'>1e-06</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>matching_neurons</th>
      <td><p>a <code><a href='https://rdrr.io/pkg/nat/man/neuronlist.html'>neuronlist</a></code> of matching neurons.</p></td>
    </tr>
    <tr>
      <th>nonmatching_neurons</th>
      <td><p>a <code><a href='https://rdrr.io/pkg/nat/man/neuronlist.html'>neuronlist</a></code> of non-matching
neurons.</p></td>
    </tr>
    <tr>
      <th>matching_subset, non_matching_subset</th>
      <td><p>data.frames indicating which pairs
of neurons in the two input neuron lists should be used to generate the
matching and null distributions. See details for the default behaviour when
<code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>ignoreSelf</th>
      <td><p>a Boolean indicating whether to ignore comparisons of a
neuron against itself (default <code>TRUE</code>).</p></td>
    </tr>
    <tr>
      <th>distbreaks</th>
      <td><p>a vector specifying the breaks for distances in the
probability matrix.</p></td>
    </tr>
    <tr>
      <th>dotprodbreaks</th>
      <td><p>a vector specifying the breaks for dot products in the
probability matrix.</p></td>
    </tr>
    <tr>
      <th>logbase</th>
      <td><p>the base to which the logarithm should be taken to produce the
final scores.</p></td>
    </tr>
    <tr>
      <th>epsilon</th>
      <td><p>a pseudocount to prevent division by zero when constructing
the log odds ratio in the probability matrix.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra arguments to pass to <code><a href='NeuriteBlast.html'>NeuriteBlast</a></code> or options
for the call to <code><a href='https://rdrr.io/pkg/plyr/man/mlply.html'>mlply</a></code> call that actually iterates over
neuron pairs.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix with columns as specified by <code>dotprodbreaks</code> and rows
  as specified by <code>distbreaks</code>, containing log odd scores for neuron
  segments with the given distance and dot product.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>By default <code>create_scoringmatrix</code> will use all neurons in
  <code>matching_neurons</code> to create the matching distribution. This is
  appropriate if all of these neurons are of a single type. If you wish to
  use multiple types of neurons then you will need to specify a
  <code>matching_subset</code> to indicate which pairs of neurons are of the same
  type.</p>
<p>By default <code>create_scoringmatrix</code> will use a random set of pairs from
  <code>non_matching_neurons</code> to create the null distribution. The number of
  random pairs will be equal to the number of matching pairs defined by
  <code>matching_neurons</code> This is appropriate if non_matching_neurons
  contains a large collection of neurons of different types. You may wish to
  set the random seed using <code><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></code> if you want to ensure that
  exactly the same (pseudo-)random pairs of neurons are used in subsequent
  calls.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='calc_score_matrix.html'>calc_score_matrix</a>, <a href='calc_prob_mat.html'>calc_prob_mat</a>,
  <a href='calc_dists_dotprods.html'>calc_dists_dotprods</a>, <a href='neuron_pairs.html'>neuron_pairs</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># calculate scoring matrix</span>
<span class='co'># bring in some mushroom body neurons</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/natverse/nat'>nat</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>kcs20</span><span class='op'>)</span>
<span class='co'># convert the (connected) tracings into dotprops (point and vector)</span>
<span class='co'># representation, resampling at 1 micron intervals along neuron</span>
<span class='va'>fctraces20.dps</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/nat/man/dotprops.html'>dotprops</a></span><span class='op'>(</span><span class='va'>fctraces20</span>, resample<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='co'># we will use both all kcs vs all fctraces20 and fctraces20 vs fctraces20</span>
<span class='co'># as random_pairs to make the null distribution</span>
<span class='va'>random_pairs</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='neuron_pairs.html'>neuron_pairs</a></span><span class='op'>(</span><span class='va'>fctraces20</span><span class='op'>)</span>, <span class='fu'><a href='neuron_pairs.html'>neuron_pairs</a></span><span class='op'>(</span><span class='fu'>nat</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/nat/man/kcs20.html'>kcs20</a></span>, <span class='va'>fctraces20</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># you can add .progress='natprogress' if this looks like taking a while</span>
<span class='va'>smat</span><span class='op'>=</span><span class='fu'>create_scoringmatrix</span><span class='op'>(</span><span class='va'>kcs20</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>kcs20</span>, <span class='va'>fctraces20.dps</span><span class='op'>)</span>,
                          non_matching_subset<span class='op'>=</span><span class='va'>random_pairs</span><span class='op'>)</span>

<span class='co'># now plot the scoring matrix</span>
<span class='va'>distbreaks</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>smat</span>,<span class='st'>'distbreaks'</span><span class='op'>)</span>
<span class='va'>distbreaks</span><span class='op'>=</span><span class='va'>distbreaks</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>distbreaks</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>dotprodbreaks</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>smat</span>,<span class='st'>'dotprodbreaks'</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
<span class='co'># Create a function interpolating colors in the range of specified colors</span>
<span class='va'>jet.colors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>, <span class='st'>"green"</span>, <span class='st'>"yellow"</span>, <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>)</span>
<span class='co'># 2d filled contour plot of scoring matrix. Notice that the there is a region</span>
<span class='co'># at small distances and large abs dot product with the highest log odds ratio</span>
<span class='co'># i.e. most indicative of a match rather than non-match</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/filled.contour.html'>filled.contour</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>distbreaks</span>, y<span class='op'>=</span><span class='va'>dotprodbreaks</span>, z<span class='op'>=</span><span class='va'>smat</span>, col<span class='op'>=</span><span class='fu'>jet.colors</span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span>,
  main<span class='op'>=</span><span class='st'>'smat: log odds ratio'</span>, xlab<span class='op'>=</span><span class='st'>'distance /um'</span>, ylab<span class='op'>=</span><span class='st'>'abs dot product'</span><span class='op'>)</span>
</div><div class='img'><img src='create_scoringmatrix-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># 3d perspective plot of the scoring matrix</span>
<span class='fu'>persp3d</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>distbreaks</span>, y<span class='op'>=</span><span class='va'>dotprodbreaks</span>, z<span class='op'>=</span><span class='va'>smat</span>, col<span class='op'>=</span><span class='fu'>jet.colors</span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='va'>smat</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>]</span>,
xlab<span class='op'>=</span><span class='st'>'distance /um'</span>, ylab<span class='op'>=</span><span class='st'>'abs dot product'</span>, zlab<span class='op'>=</span><span class='st'>'log odds ratio'</span><span class='op'>)</span>
<span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


